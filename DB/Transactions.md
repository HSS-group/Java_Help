### Что такое транзакция?

Транзакция это последовательность операций, выполняемых над БД которые
должны быть выполнены полностью или не выполнены вообще.

Предположим, у нас есть транзакция:
```sql
UPDATE ACCOUNTS SET BALANCE = BALANCE - 150 WHERE ACCOUNT NUMBER = 123;

UPDATE ACCOUNTS SET BALANCE = BALANCE + 150 WHERE ACCOUNT NUMBER = 124;
```

У нас может быть ситуация, когда ондна из комманд в транзакции не выополнится,
и тогда у нас будет нарушена согласованность бд.

#### Причины не выполнения одной из операций:

- Отказ СУБД
- Отказ приложения пользователя
- Потеря сетевого соединения клиента и сервера субд

Для начала транзакции мы используем "START TRANSACTION". Далее у нас есть
2 варианта, мы можем зафиксировать транзакцию "COMMIT" и откатить транзакцию "ROLLBACK"


Многие современные СУБД используют автоматическую фиксацию транзакций, это 
специальный режим работы СУБД, когда после выполнения каждой комманды SQL автоматически
фиксируется транзакция, и следовательно ее нет возможности отменить.

<br>

#### Пример использования данного режима:
- PostgreSQL - включено по умолчанию
- Oracle - выключено по умолчанию

<br>

#### Завершение транзакций происходит тогда:

- Явное подтверждение или отмена транзакции (COMMIT, ROLLBACK)
- Запуск комманд создания, изменения или удаления таблиц
- Сбой сервера СУБД (Происходит откат всех незавершенных транзакций после восстановления сервера)
- Сбой клиента СУБД (Откат незавершенной транзакции после тайм-аута)

<br>

#### Основные концепции транзакции описываются аббревиатурой ACID
Atomicity, Consistency, Isolation, Durability (Атомарность, Согласованность, Изолированность, Долговечность).

1. Атомарность

Атомарность гарантирует, что любая транзакция будет зафиксирована только целиком (полностью). 
Если одна из операций в последовательности не будет выполнена, то вся транзакция будет отменена. 
Тут вводится понятие “отката” (rollback). Т.е. внутри последовательности будут происходить определённые изменения, 
но по итогу все они будут отменены (“откачены”) и по итогу пользователь не увидит никаких изменений.

2. Согласованность

Это означает, что любая завершённая транзакция (транзакция, которая достигла завершения транзакции – end of 
transaction) фиксирует только допустимые результаты. Например, при переводе денег с одного счёта на другой, в 
случае, если деньги ушли с одного счёта, они должны прийти на другой (это и есть согласованность системы). 
Списание и зачисление  – это две разные транзакции, поэтому первая транзакция пройдёт без ошибок, а второй просто не 
будет. Именно поэтому крайне важно учитывать это свойство и поддерживать баланс системы.

3. Изолированность

Каждая транзакция должна быть изолирована от других, т.е. её результат не должен зависеть от выполнения 
других параллельных транзакций. На практике, изолированность крайне труднодостижимая вещь, поэтому здесь 
вводится понятие “уровни изолированности” (транзакция изолируется не полностью).

4. Долговечность

Эта концепция гарантирует, что если мы получили подтверждение о выполнении транзакции, то изменения, 
вызванные этой транзакцией не должны быть отменены из-за сбоя системы (например, отключение электропитания).